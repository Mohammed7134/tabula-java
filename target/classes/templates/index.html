<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <title>PDF Table Processor</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    </head>

    <body>
        <h1>Upload Expiries, Detailed & brief PDFs (Assumes 2-months data)</h1>
        <form id="uploadForm" enctype="multipart/form-data">
            <label>Expiries PDF:</label>
            <input type="file" name="expiries" accept="application/pdf" required><br><br>
            <label>Detailed PDF:</label>
            <input type="file" name="detailed" accept="application/pdf" required><br><br>
            <label>brief PDF:</label>
            <input type="file" name="brief" accept="application/pdf" required><br><br>
            <label>Requested PDF:</label>
            <input type="file" name="requested" accept="application/pdf"><br><br>
            <button type="submit">Upload & Process</button>
        </form>

        <hr>
        <div id="tableContainer"></div>

        <script>
            $('#uploadForm').on('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);

                fetch('/process-all', {
                    method: 'POST',
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        $('#tableContainer').html(data.html);
                        $('#catalogueTable').DataTable({
                            paging: true,
                            searching: true,
                            ordering: true,
                            info: true,
                            pageLength: 2000,
                            lengthMenu: [2000, 1000, 500, 100, 50, 25, 10],
                            language: {
                                search: "Search Catalogue:",
                                lengthMenu: "Show _MENU_ entries",
                                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                                infoEmpty: "No entries available",
                                infoFiltered: "(filtered from _MAX_ total entries)",
                                paginate: {
                                    first: "First",
                                    last: "Last",
                                    next: "Next",
                                    previous: "Previous"
                                }
                            }
                        });
                    })
                    .catch(err => {
                        console.error(err);
                        alert("Error occurred during processing.");
                    });
            });
        </script>
    </body>

</html>